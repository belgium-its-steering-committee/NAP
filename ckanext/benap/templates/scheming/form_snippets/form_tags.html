{% import 'macros/form.html' as form %}

<style>
fieldset.checkboxes label {
    font-weight: normal;
    display: block;
}
fieldset.checkboxes label:after {
    content: none;
}
fieldset.checkboxes label input {
    width: auto;
    top: 0;
}
</style>

{%- call form.input_block(
    label=h.scheming_language_text(field.label),
    classes=['control-medium'],
    error=errors[field.field_name],
    is_required=h.scheming_field_required(field)) -%}
  {%- set choices = [([('Air', 'Air'), ('rail', 'rail'), ('conventional rail', 'conventional rail')], 'Scheduled'),
            ([('Shuttle bus', 'Shuttle bus'), ('Shuttle ferry', 'Shuttle ferry'), ('Taxi', 'Taxi')], 'Demand-responsive'),
            ([('Car', 'Car'), ('truck', 'truck'), ('motorcycle', 'motorcycle')], 'Personal')] -%}
    <p>{{ list3 }}</p>
  {%- if field.get('sorted_choices') -%}
    {%- set choices = choices|sort(case_sensitive=false, attribute=1) -%}
  {%- endif -%}
    <fieldset class="checkboxes">
        {%- for tags, category in choices -%}
            <div id="collapse-{{ category }}" class="flex-between border-1" style="padding: 6px 12px">
                <h3 class="m-0" style="font-size: 14px; font-weight: bold;">
                    {{ category }}
                </h3>
                <div id="collapse-{{ category }}-open" style="padding-right: 4px; font-size: 10px;">
                    <span class="caret"></span>
                </div>
                <div id="collapse-{{ category }}-close" style="padding-right: 4px; font-size: 10px;">
                    <span class="dropup">
                        <span class="caret"></span>
                    </span>
                </div>
            </div>
            <div id="collapse-content-{{ category }}" class="border-1 pl-12 transport-mode-collapse-content">
                {%- for val, label in tags -%}
                    <label for="field-{{ field.field_name }}-{{ val }}">
                        <input id="field-{{ field.field_name }}-{{ val }}"
                            type="checkbox"
                            name="{{ field.field_name }}"
                            value="{{ val }}"
                            {{"checked " if val in data[field.field_name] }} />
                        {{ label }}
                        <script>
                            $('#field-tag_string').parent().parent().hide();

                            $('input[value="{{ val }}"]').change(function() {
                                if (this.checked) {
                                    let tags = $('#field-tag_string').val().split(',');
                                    tags.push(this.value);
                                    $('#field-tag_string').val(tags.join().replace(/^,/, ''));
                                } else {
                                    let tags = $('#field-tag_string').val().split(',');
                                    let remainingTags = [];
                                    tags.forEach(tag => {
                                        if (tag.trim() !== this.value) {
                                            remainingTags.push(tag);
                                        }
                                    });
                                    remainingTags.join();
                                    $('#field-tag_string').val(remainingTags);
                                }
                            });
                        </script>
                    </label>
                {%- endfor -%}
            </div>
            <script>
                $('#collapse-content-{{ category }}').toggle();
                $('#collapse-{{ category }}-close').toggle();
                $('#collapse-{{ category }}').click(function() {
                    $('#collapse-content-{{ category }}').toggle();
                    $('#collapse-{{ category }}-close').toggle();
                    $('#collapse-{{ category }}-open').toggle();
                });
            </script>
        {%- endfor -%}

    </fieldset>
    {%- snippet 'scheming/form_snippets/help_text.html', field=field -%}
{%- endcall -%}
